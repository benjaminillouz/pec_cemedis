<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Paiement - Ma PEC</title>
    <link rel="stylesheet" href="ma-pec-styles-FINAL.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <img src="https://static.wixstatic.com/media/b07e07_3003a06c5f8c4e0e8e019707a0f94594~mv2.png" 
                     alt="Logo du centre" class="logo" id="centre-logo">
                <div class="header-text">
                    <h1>Ma Prise en Charge Dentaire</h1>
                    <p class="pec-number">PEC n° <span id="pec-id">10961489</span></p>
                </div>
            </div>
            <div class="patient-info">
                <div class="patient-details">
                    <h2><i class="fas fa-user"></i> <span id="patient-name">FOURNOT Micke</span></h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">Centre :</span>
                            <span id="centre-name">Centre Dentaire Pontault-Emerainville</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Praticien :</span>
                            <span id="praticien-name">M. CHIKH Adil</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Date :</span>
                            <span id="pec-date">25/09/25</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <ul class="nav-list">
                <li><a href="#pec" class="nav-link active" data-section="pec">
                    <i class="fas fa-file-medical"></i> Ma PEC
                </a></li>
                <li><a href="#remboursements" class="nav-link" data-section="remboursements">
                    <i class="fas fa-euro-sign"></i> Mes Remboursements
                </a></li>
                <li><a href="#financement" class="nav-link" data-section="financement">
                    <i class="fas fa-credit-card"></i> Financement
                </a></li>
            </ul>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        <div class="container">
            <!-- Section PEC -->
            <section id="pec" class="content-section active">
                <div class="section-header">
                    <h2><i class="fas fa-file-medical"></i> Ma Prise en Charge</h2>
                    <p>Informations générales de votre prise en charge</p>
                </div>

                <!-- Résumé financier -->
                <div class="summary-section">
                    <div class="summary-grid">
                        <div class="summary-item total">
                            <span class="label">Montant Total</span>
                            <span class="value" id="total-amount">500 €</span>
                        </div>
                        <div class="summary-item security">
                            <span class="label">Sécurité Sociale</span>
                            <span class="value" id="ss-amount">78 €</span>
                        </div>
                        <div class="summary-item mutuelle">
                            <span class="label">Mutuelle</span>
                            <span class="value" id="mut-amount">422 €</span>
                        </div>
                        <div class="summary-item remaining">
                            <span class="label">À votre charge</span>
                            <span class="value" id="rac-amount">0 €</span>
                        </div>
                    </div>
                </div>

                <!-- Informations patient -->
                <div class="patient-section">
                    <h3><i class="fas fa-user-md"></i> Informations Patient</h3>
                    <div class="patient-grid">
                        <div class="patient-card">
                            <div class="patient-label">Nom</div>
                            <div class="patient-value" id="patient-nom">FOURNOT</div>
                        </div>
                        <div class="patient-card">
                            <div class="patient-label">Prénom</div>
                            <div class="patient-value" id="patient-prenom">Micke</div>
                        </div>
                        <div class="patient-card">
                            <div class="patient-label">Téléphone</div>
                            <div class="patient-value" id="patient-tel">0669472661</div>
                        </div>
                        <div class="patient-card">
                            <div class="patient-label">Email</div>
                            <div class="patient-value" id="patient-email">work:mickefournot@gmail.com</div>
                        </div>
                    </div>
                </div>

                <!-- Bouton de prise de rendez-vous -->
                <div class="appointment-section">
                    <div class="appointment-card">
                        <div class="appointment-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div class="appointment-content">
                            <h3>Prendre un rendez-vous</h3>
                            <p>Planifiez votre prochaine consultation en ligne</p>
                            <button class="btn btn-primary" onclick="handleAppointment()">
                                <i class="fas fa-calendar-check"></i> Prendre RDV
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section Remboursements -->
            <section id="remboursements" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-euro-sign"></i> Mes Remboursements</h2>
                    <p>Détail de vos remboursements Sécurité Sociale et mutuelle</p>
                </div>

                <div class="remboursement-cards">
                    <div class="remboursement-card security">
                        <div class="card-header">
                            <i class="fas fa-shield-alt"></i>
                            <h3>Sécurité Sociale</h3>
                        </div>
                        <div class="card-content">
                            <div class="amount" id="ss-amount-remboursements">78 €</div>
                            <p>Remboursement direct de la Sécurité Sociale à votre établissement. Ce montant correspond à la colonne 'Part RO' ou 'Part S.S' sur un devis.</p>
                            <div class="calculation">
                                <small>Calculé à 60% de la Base de Remboursement (BR)</small>
                            </div>
                        </div>
                    </div>

                    <div class="remboursement-card mutuelle">
                        <div class="card-header">
                            <i class="fas fa-heart"></i>
                            <h3>Mutuelle Complémentaire</h3>
                        </div>
                        <div class="card-content">
                            <div class="amount" id="mut-amount-remboursements">422 €</div>
                            <p>Montant remboursé par votre mutuelle complémentaire. Ce montant peut être réglé directement à notre établissement si votre mutuelle accepte la Prise En Charge Tiers Payant.</p>
                            <div class="benefit">
                                <i class="fas fa-check-circle"></i>
                                <span>Nos services s'occupent de toutes les démarches</span>
                            </div>
                        </div>
                    </div>

                    <div class="remboursement-card remaining">
                        <div class="card-header">
                            <i class="fas fa-wallet"></i>
                            <h3>À Votre Charge</h3>
                        </div>
                        <div class="card-content">
                            <div class="amount" id="rac-amount-remboursements">0 €</div>
                            <p>Montant que vous devez régler à l'établissement. Un acompte d'au moins 50% du montant à payer doit être versé lors de la commande des prothèses.</p>
                            <div class="payment-info">
                                <i class="fas fa-info-circle"></i>
                                <span>Solutions de paiement en plusieurs fois disponibles</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section Financement -->
            <section id="financement" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-credit-card"></i> Financement</h2>
                    <p>Solutions de paiement pour votre traitement</p>
                </div>

                <div class="amount-section">
                    <div class="amount-card">
                        <h3><i class="fas fa-euro-sign"></i> Montant à payer</h3>
                        <div class="amount-display" id="total-amount-financement">0 €</div>
                    </div>
                </div>

                <div class="amount-selection">
                    <h3>Sélectionnez un montant à financer</h3>
                    <div class="slider-container">
                        <input type="range" id="payment-slider" min="10" max="1000" value="100" class="slider">
                        <div class="slider-labels">
                            <span>10 €</span>
                            <span id="selected-amount">100 €</span>
                            <span>1000 €</span>
                        </div>
                    </div>
                </div>

                <div class="financing-options">
                    <h3>Choisir votre mode de financement</h3>
                    <div class="financing-grid">
                        <div class="financing-option" id="klarna-financing">
                            <img src="https://static.wixstatic.com/media/b07e07_0603c1b3abd44130b7cea01b7f41b57e~mv2.png" 
                                 alt="Klarna" class="financing-logo">
                            <div class="financing-info">
                                <h4>Klarna 3x 4x</h4>
                                <p>Paiement en 3 ou 4 fois sans frais</p>
                            </div>
                        </div>

                        <div class="financing-option" id="veasy-financing">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Oney_logo.svg/200px-Oney_logo.svg.png" 
                                 alt="Oney" class="financing-logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjQwIiB2aWV3Qm94PSIwIDAgMTAwIDQwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzAwNEI2MyIvPgo8dGV4dCB4PSI1MCIgeT0iMjUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5PTkVZPC90ZXh0Pgo8L3N2Zz4K'">
                            <div class="financing-info">
                                <h4>Oney 3x 4x</h4>
                                <p>Paiement en 3 ou 4 fois sans frais</p>
                            </div>
                        </div>

                        <div class="financing-option" id="cb-financing">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/200px-Visa_Inc._logo.svg.png" 
                                 alt="Cartes Bancaires" class="financing-logo">
                            <div class="financing-info">
                                <h4>Cartes Bancaires</h4>
                                <p>Paiement sécurisé par carte bancaire</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="financing-info-section">
                    <div class="info-card">
                        <i class="fas fa-shield-alt"></i>
                        <h4>Paiement Sécurisé</h4>
                        <p>Toutes les transactions sont protégées par un cryptage SSL</p>
                    </div>
                    <div class="info-card">
                        <i class="fas fa-clock"></i>
                        <h4>Validation Rapide</h4>
                        <p>Votre demande de financement est traitée en quelques minutes</p>
                    </div>
                </div>

                <!-- Section de test des liens -->
                <div class="test-section">
                    <h3><i class="fas fa-bug"></i> Test des liens de paiement</h3>
                    <div class="test-buttons">
                        <button class="btn btn-secondary" onclick="testKlarna()">
                            <i class="fas fa-test-tube"></i> Test Klarna
                        </button>
                        <button class="btn btn-secondary" onclick="testOney()">
                            <i class="fas fa-test-tube"></i> Test Oney
                        </button>
                        <button class="btn btn-secondary" onclick="testCB()">
                            <i class="fas fa-test-tube"></i> Test CB
                        </button>
                    </div>
                    <div class="test-results" id="test-results">
                        <p>Cliquez sur un bouton de test pour voir les résultats...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="ma-pec-script-FINAL.js"></script>
    <script>
        // Fonctions de test spécifiques
        function testKlarna() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Test Klarna en cours...</p>';
            
            handleFinancing('klarna').then(response => {
                results.innerHTML = `
                    <div class="test-success">
                        <h4><i class="fas fa-check-circle"></i> Test Klarna réussi</h4>
                        <p><strong>Réponse:</strong> ${JSON.stringify(response, null, 2)}</p>
                    </div>
                `;
            }).catch(error => {
                results.innerHTML = `
                    <div class="test-error">
                        <h4><i class="fas fa-exclamation-triangle"></i> Test Klarna échoué</h4>
                        <p><strong>Erreur:</strong> ${error.message}</p>
                    </div>
                `;
            });
        }

        function testOney() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Test Oney en cours...</p>';
            
            handleFinancing('veasy').then(response => {
                results.innerHTML = `
                    <div class="test-success">
                        <h4><i class="fas fa-check-circle"></i> Test Oney réussi</h4>
                        <p><strong>Réponse:</strong> ${JSON.stringify(response, null, 2)}</p>
                    </div>
                `;
            }).catch(error => {
                results.innerHTML = `
                    <div class="test-error">
                        <h4><i class="fas fa-exclamation-triangle"></i> Test Oney échoué</h4>
                        <p><strong>Erreur:</strong> ${error.message}</p>
                    </div>
                `;
            });
        }

        function testCB() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Test CB en cours...</p>';
            
            handleFinancing('card').then(response => {
                results.innerHTML = `
                    <div class="test-success">
                        <h4><i class="fas fa-check-circle"></i> Test CB réussi</h4>
                        <p><strong>Réponse:</strong> ${JSON.stringify(response, null, 2)}</p>
                    </div>
                `;
            }).catch(error => {
                results.innerHTML = `
                    <div class="test-error">
                        <h4><i class="fas fa-exclamation-triangle"></i> Test CB échoué</h4>
                        <p><strong>Erreur:</strong> ${error.message}</p>
                    </div>
                `;
            });
        }

        // Initialisation avec des paramètres de test
        document.addEventListener('DOMContentLoaded', function() {
            // Simuler les paramètres URL pour les tests
            const testParams = {
                'idDevis': '10961489',
                'centre': 'Centre Dentaire Pontault-Emerainville',
                'praticien': 'M. CHIKH Adil',
                'date': '25/09/25',
                'patientnom': 'FOURNOT',
                'patientprenom': 'Micke',
                'total': '500',
                'ss': '78',
                'mut': '422',
                'rac': '0',
                'idCentre': '3843',
                'idPat': '26868898',
                'quotation_pdf': 'https://cemedis.app/W9sTQN9OUmHcsX6KZV0H',
                'idPodio': '3170719791',
                'br': '3292952679095559',
                'tel': '0669472661',
                'idPraticien': '22960405',
                'mail': 'work:mickefournot@gmail.com',
                'logo': 'https://static.wixstatic.com/media/b07e07_3003a06c5f8c4e0e8e019707a0f94594~mv2.png'
            };

            // Simuler les paramètres URL
            const url = new URL(window.location);
            Object.keys(testParams).forEach(key => {
                url.searchParams.set(key, testParams[key]);
            });
            window.history.replaceState({}, '', url);

            // Initialiser l'application
            initializeApp();
        });
    </script>

    <style>
        .test-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }

        .test-buttons {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .test-results {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--background-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .test-success {
            color: var(--success-color);
        }

        .test-error {
            color: var(--error-color);
        }

        .test-results pre {
            background: var(--white);
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.875rem;
        }
    </style>
</body>
</html>
